from fastapi import FastAPI
from pydantic import BaseModel
import random
import spacy
import sudachipy
from sudachipy import dictionary

# FastAPI インスタンス
app = FastAPI()

@app.get("/")
def root():
    return {"message": "FastAPI is running!"}

import os

# SudachiPy & spaCy モデルのロード（sudachidict_full を明示的に指定）
dic_path = os.path.join(os.path.dirname(sudachipy.__file__), "resources", "sudachidict_full")
sudachi_tokenizer = dictionary.Dictionary(dic_path).create()

nlp = spacy.load("ja_core_news_md")


# 駅・市町村・商業施設・商店街リスト（仮のデータ構造、実際のデータは別ファイルからロード）
prefecture_stations = {
    "北海道": ["札幌駅", "旭川駅", "函館駅", "小樽駅", "帯広駅", "釧路駅", "北見駅", "苫小牧駅", "室蘭駅", "江別駅", "千歳駅", "岩見沢駅", "滝川駅", "名寄駅", "根室駅", "稚内駅", "夕張駅", "留萌駅", "登別駅", "網走駅"],
    "青森県": ["青森駅", "弘前駅", "八戸駅", "五所川原駅", "十和田駅", "三沢駅", "むつ駅", "野辺地駅", "黒石駅", "つがる駅"],
    "岩手県": ["盛岡駅", "一関駅", "北上駅", "釜石駅", "宮古駅", "花巻駅", "久慈駅", "遠野駅", "大船渡駅", "八幡平駅"],
    "宮城県": ["仙台駅", "石巻駅", "塩釜駅", "大崎駅", "白石駅", "多賀城駅", "名取駅", "角田駅", "気仙沼駅", "岩沼駅", "登米駅", "栗原駅", "富谷駅", "東松島駅", "亘理駅"],
    "秋田県": ["秋田駅", "大館駅", "横手駅", "湯沢駅", "由利本荘駅", "男鹿駅", "能代駅", "鹿角駅", "大仙駅", "潟上駅"],
    "山形県": ["山形駅", "米沢駅", "鶴岡駅", "酒田駅", "新庄駅", "天童駅", "長井駅", "南陽駅", "寒河江駅", "上山駅"],
    "福島県": ["福島駅", "郡山駅", "いわき駅", "会津若松駅", "白河駅", "須賀川駅", "二本松駅", "南相馬駅", "相馬駅", "喜多方駅", "田村駅", "本宮駅", "伊達駅", "三春駅", "広野駅"],
    "茨城県": ["水戸駅", "つくば駅", "土浦駅", "ひたちなか駅", "日立駅", "取手駅", "牛久駅", "龍ケ崎駅", "石岡駅", "常総駅", "鹿嶋駅", "かすみがうら駅", "守谷駅", "神栖駅", "筑西駅"],
    "栃木県": ["宇都宮駅", "小山駅", "佐野駅", "足利駅", "日光駅", "真岡駅", "矢板駅", "那須塩原駅", "大田原駅", "さくら駅", "栃木駅", "鹿沼駅", "下野駅", "壬生駅", "高根沢駅"],
    "群馬県": ["前橋駅", "高崎駅", "桐生駅", "伊勢崎駅", "館林駅", "渋川駅", "富岡駅", "安中駅", "藤岡駅", "みどり駅", "太田駅", "沼田駅", "吾妻駅", "榛名駅", "草津駅"],
    "山梨県": ["甲府駅", "富士吉田駅", "韮崎駅", "南アルプス駅", "都留駅", "山梨駅", "甲斐駅", "大月駅", "上野原駅", "笛吹駅"],
    "長野県": ["長野駅", "松本駅", "上田駅", "岡谷駅", "飯田駅", "諏訪駅", "伊那駅", "駒ヶ根駅", "茅野駅", "小諸駅", "佐久駅", "東御駅", "安曇野駅", "中野駅", "須坂駅"],
    "岐阜県": ["岐阜駅", "高山駅", "大垣駅", "関駅", "各務原駅", "多治見駅", "中津川駅", "瑞浪駅", "可児駅", "羽島駅", "美濃駅", "下呂駅", "郡上駅", "恵那駅", "飛騨駅"],
    "静岡県": ["静岡駅", "浜松駅", "沼津駅", "富士駅", "三島駅", "磐田駅", "焼津駅", "御殿場駅", "掛川駅", "島田駅", "富士宮駅", "裾野駅", "湖西駅", "伊東駅", "熱海駅"],
    "愛知県": ["名古屋駅", "豊橋駅", "岡崎駅", "一宮駅", "瀬戸駅", "春日井駅", "豊田駅", "安城駅", "西尾駅", "刈谷駅", "半田駅", "小牧駅", "稲沢駅", "江南駅", "新城駅", "蒲郡駅", "東海駅", "長久手駅", "尾張旭駅", "高浜駅"],
    "三重県": ["津駅", "四日市駅", "伊勢駅", "松阪駅", "鈴鹿駅", "亀山駅", "名張駅", "熊野駅", "桑名駅", "志摩駅"],
    "滋賀県": ["大津駅", "彦根駅", "長浜駅", "草津駅", "近江八幡駅", "守山駅", "野洲駅", "栗東駅", "高島駅", "甲賀駅"],
    "京都府": ["京都駅", "宇治駅", "舞鶴駅", "福知山駅", "亀岡駅", "長岡京駅", "八幡駅", "京田辺駅", "木津川駅", "向日駅", "綾部駅", "宮津駅", "南丹駅", "城陽駅", "与謝野駅"],
    "大阪府": ["大阪駅", "堺駅", "豊中駅", "東大阪駅", "枚方駅", "吹田駅", "高槻駅", "茨木駅", "八尾駅", "寝屋川駅", "和泉駅", "松原駅", "羽曳野駅", "門真駅", "摂津駅", "大東駅", "貝塚駅", "泉佐野駅", "河内長野駅", "藤井寺駅"],
    "兵庫県": ["神戸駅", "姫路駅", "尼崎駅", "西宮駅", "明石駅", "加古川駅", "宝塚駅", "伊丹駅", "川西駅", "三田駅", "豊岡駅", "赤穂駅", "篠山駅", "養父駅", "洲本駅"],
    "奈良県": ["奈良駅", "橿原駅", "生駒駅", "大和郡山駅", "天理駅", "桜井駅", "五條駅", "御所駅", "香芝駅", "葛城駅"],
    "和歌山県": ["和歌山駅", "田辺駅", "新宮駅", "橋本駅", "御坊駅", "海南駅", "有田駅", "紀の川駅", "那智勝浦駅", "白浜駅"],
    "鳥取県": ["鳥取駅", "米子駅", "倉吉駅", "境港駅", "八頭駅", "琴浦駅", "湯梨浜駅", "日野駅", "伯耆駅", "岩美駅"],
    "島根県": ["松江駅", "出雲駅", "浜田駅", "益田駅", "大田駅", "雲南駅", "江津駅", "安来駅", "隠岐駅", "仁多駅"],
    "岡山県": ["岡山駅", "倉敷駅", "津山駅", "玉野駅", "笠岡駅", "総社駅", "備前駅", "高梁駅", "瀬戸内駅", "新見駅"],
    "広島県": ["広島駅", "呉駅", "福山駅", "尾道駅", "三原駅", "東広島駅", "府中駅", "竹原駅", "安芸高田駅", "廿日市駅"],
    "山口県": ["山口駅", "下関駅", "宇部駅", "岩国駅", "萩駅", "防府駅", "長門駅", "周南駅", "山陽小野田駅", "光駅"],
    "徳島県": ["徳島駅", "鳴門駅", "阿南駅", "吉野川駅", "美馬駅", "三好駅", "小松島駅", "板野駅", "石井駅", "那賀駅"],
    "香川県": ["高松駅", "丸亀駅", "坂出駅", "観音寺駅", "三豊駅", "善通寺駅", "東かがわ駅", "さぬき駅", "直島駅", "土庄駅"],
    "愛媛県": ["松山駅", "今治駅", "新居浜駅", "西条駅", "宇和島駅", "大洲駅", "八幡浜駅", "西予駅", "伊予駅", "東温駅"],
    "高知県": ["高知駅", "四万十駅", "安芸駅", "須崎駅", "南国駅", "土佐駅", "香南駅", "宿毛駅", "室戸駅", "吾川駅"],
    "福岡県": ["福岡駅", "北九州駅", "久留米駅", "飯塚駅", "行橋駅", "筑紫野駅", "春日駅", "宗像駅", "柳川駅", "大牟田駅"],
    "佐賀県": ["佐賀駅", "唐津駅", "鳥栖駅", "伊万里駅", "武雄駅", "鹿島駅", "多久駅", "小城市", "嬉野駅", "白石駅"],
    "長崎県": ["長崎駅", "佐世保駅", "諫早駅", "島原駅", "大村駅", "平戸駅", "雲仙駅", "松浦駅", "西海駅", "南島原駅"],
    "熊本県": ["熊本駅", "上熊本駅", "光の森駅", "水前寺駅", "武蔵塚駅", "八代駅", "天草駅", "玉名駅", "宇城駅", "阿蘇駅"],
    "大分県": ["大分駅", "別府駅", "中津駅", "日田駅", "佐伯駅", "宇佐駅", "豊後大野駅", "杵築駅", "由布駅", "津久見駅"],
    "宮崎県": ["宮崎駅", "都城駅", "日南駅", "延岡駅", "小林駅", "串間駅", "えびの駅", "高鍋駅", "西都駅", "日向駅"],
    "鹿児島県": ["鹿児島駅", "鹿屋駅", "霧島駅", "薩摩川内駅", "指宿駅", "枕崎駅", "南さつま駅", "阿久根駅", "出水駅", "奄美駅"],
    "沖縄県": ["那覇駅", "浦添駅", "名護駅", "糸満駅", "宮古島駅", "石垣駅", "うるま駅", "宜野湾駅", "本部駅", "南城市"]
}
prefecture_cities = {
"北海道": ["札幌市", "旭川市", "函館市", "小樽市", "帯広市", "釧路市", "北見市", "苫小牧市", "室蘭市", "江別市", "千歳市", "岩見沢市", "滝川市", "名寄市", "根室市", "稚内市", "夕張市", "留萌市", "登別市", "網走市"],
    "青森県": ["青森市", "弘前市", "八戸市", "五所川原市", "十和田市", "三沢市", "むつ市", "野辺地町", "黒石市", "つがる市"],
    "岩手県": ["盛岡市", "一関市", "北上市", "釜石市", "宮古市", "花巻市", "久慈市", "遠野市", "大船渡市", "八幡平市"],
    "宮城県": ["仙台市", "石巻市", "塩釜市", "大崎市", "白石市", "多賀城市", "名取市", "角田市", "気仙沼市", "岩沼市", "登米市", "栗原市", "富谷市", "東松島市", "亘理町"],
    "秋田県": ["秋田市", "大館市", "横手市", "湯沢市", "由利本荘市", "男鹿市", "能代市", "鹿角市", "大仙市", "潟上市"],
    "山形県": ["山形市", "米沢市", "鶴岡市", "酒田市", "新庄市", "天童市", "長井市", "南陽市", "寒河江市", "上山市"],
    "福島県": ["福島市", "郡山市", "いわき市", "会津若松市", "白河市", "須賀川市", "二本松市", "南相馬市", "相馬市", "喜多方市", "田村市", "本宮市", "伊達市", "三春町", "広野町"],
    "茨城県": ["水戸市", "つくば市", "土浦市", "ひたちなか市", "日立市", "取手市", "牛久市", "龍ケ崎市", "石岡市", "常総市", "鹿嶋市", "かすみがうら市", "守谷市", "神栖市", "筑西市"],
    "栃木県": ["宇都宮市", "小山市", "佐野市", "足利市", "日光市", "真岡市", "矢板市", "那須塩原市", "大田原市", "さくら市", "栃木市", "鹿沼市", "下野市", "壬生町", "高根沢町"],
    "群馬県": ["前橋市", "高崎市", "桐生市", "伊勢崎市", "館林市", "渋川市", "富岡市", "安中市", "藤岡市", "みどり市", "太田市", "沼田市", "吾妻町", "榛名町", "草津町"],
    "山梨県": ["甲府市", "富士吉田市", "韮崎市", "南アルプス市", "都留市", "山梨市", "甲斐市", "大月市", "上野原市", "笛吹市"],
    "長野県": ["長野市", "松本市", "上田市", "岡谷市", "飯田市", "諏訪市", "伊那市", "駒ヶ根市", "茅野市", "小諸市", "佐久市", "東御市", "安曇野市", "中野市", "須坂市"],
    "岐阜県": ["岐阜市", "高山市", "大垣市", "関市", "各務原市", "多治見市", "中津川市", "瑞浪市", "可児市", "羽島市", "美濃市", "下呂市", "郡上市", "恵那市", "飛騨市"],
    "静岡県": ["静岡市", "浜松市", "沼津市", "富士市", "三島市", "磐田市", "焼津市", "御殿場市", "掛川市", "島田市", "富士宮市", "裾野市", "湖西市", "伊東市", "熱海市"],
    "愛知県": ["名古屋市", "豊橋市", "岡崎市", "一宮市", "瀬戸市", "春日井市", "豊田市", "安城市", "西尾市", "刈谷市", "半田市", "小牧市", "稲沢市", "江南市", "新城市", "蒲郡市", "東海市", "長久手市", "尾張旭市", "高浜市"],
    "東京都": ["千代田区", "中央区", "港区", "新宿区", "文京区", "台東区", "墨田区", "江東区", "品川区", "目黒区", "大田区", "世田谷区", "渋谷区", "中野区", "杉並区", "豊島区", "北区", "荒川区", "板橋区", "練馬区", "足立区", "葛飾区", "江戸川区", "八王子市", "立川市", "武蔵野市", "三鷹市", "青梅市", "府中市", "昭島市", "調布市", "町田市", "小金井市", "小平市", "日野市", "東村山市", "国分寺市", "国立市", "福生市", "狛江市", "東大和市", "清瀬市", "東久留米市", "武蔵村山市", "多摩市", "稲城市", "羽村市", "あきる野市", "西東京市"],
    "埼玉県": ["さいたま市", "川越市", "熊谷市", "川口市", "行田市", "秩父市", "所沢市", "飯能市", "加須市", "本庄市", "東松山市", "春日部市", "狭山市", "羽生市", "鴻巣市", "深谷市", "上尾市", "草加市", "越谷市", "蕨市", "戸田市", "入間市", "朝霞市", "志木市", "和光市", "新座市", "桶川市", "久喜市", "北本市", "八潮市", "富士見市", "三郷市", "蓮田市", "坂戸市", "幸手市", "鶴ヶ島市", "日高市", "吉川市", "ふじみ野市"],
    "千葉県": ["千葉市", "銚子市", "市川市", "船橋市", "館山市", "木更津市", "松戸市", "野田市", "茂原市", "成田市", "佐倉市", "東金市", "旭市", "習志野市", "柏市", "勝浦市", "市原市", "流山市", "八千代市", "我孫子市", "鴨川市", "鎌ヶ谷市", "君津市", "富津市", "浦安市", "四街道市", "袖ケ浦市", "八街市", "印西市", "白井市", "富里市", "南房総市", "匝瑳市", "香取市", "山武市", "いすみ市"],
    "神奈川県": ["横浜市", "川崎市", "相模原市", "横須賀市", "平塚市", "鎌倉市", "藤沢市", "小田原市", "茅ヶ崎市", "逗子市", "三浦市", "秦野市", "厚木市", "大和市", "伊勢原市", "海老名市", "座間市", "南足柄市", "綾瀬市"],
    "三重県": ["津市", "四日市市", "伊勢市", "松阪市", "鈴鹿市", "亀山市", "名張市", "熊野市", "桑名市", "志摩市"],
    "滋賀県": ["大津市", "彦根市", "長浜市", "草津市", "近江八幡市", "守山市", "野洲市", "栗東市", "高島市", "甲賀市"],
    "京都府": ["京都市", "宇治市", "舞鶴市", "福知山市", "亀岡市", "長岡京市", "八幡市", "京田辺市", "木津川市", "向日市", "綾部市", "宮津市", "南丹市", "城陽市", "与謝野町"],
    "大阪府": ["大阪市", "堺市", "豊中市", "東大阪市", "枚方市", "吹田市", "高槻市", "茨木市", "八尾市", "寝屋川市", "和泉市", "松原市", "羽曳野市", "門真市", "摂津市", "大東市", "貝塚市", "泉佐野市", "河内長野市", "藤井寺市"],
    "兵庫県": ["神戸市", "姫路市", "尼崎市", "西宮市", "明石市", "加古川市", "宝塚市", "伊丹市", "川西市", "三田市", "豊岡市", "赤穂市", "丹波篠山市", "養父市", "洲本市"],
    "奈良県": ["奈良市", "橿原市", "生駒市", "大和郡山市", "天理市", "桜井市", "五條市", "御所市", "香芝市", "葛城市"],
    "和歌山県": ["和歌山市", "田辺市", "新宮市", "橋本市", "御坊市", "海南市", "有田市", "紀の川市", "那智勝浦町", "白浜町"],
    "鳥取県": ["鳥取市", "米子市", "倉吉市", "境港市", "八頭町", "琴浦町", "湯梨浜町", "日野町", "伯耆町", "岩美町"],
    "島根県": ["松江市", "出雲市", "浜田市", "益田市", "大田市", "雲南市", "江津市", "安来市", "隠岐の島町", "仁多町"],
    "岡山県": ["岡山市", "倉敷市", "津山市", "玉野市", "笠岡市", "総社市", "備前市", "高梁市", "瀬戸内市", "新見市"],
    "広島県": ["広島市", "呉市", "福山市", "尾道市", "三原市", "東広島市", "府中市", "竹原市", "安芸高田市", "廿日市市"],
    "山口県": ["山口市", "下関市", "宇部市", "岩国市", "萩市", "防府市", "長門市", "周南市", "山陽小野田市", "光市"],
    "徳島県": ["徳島市", "鳴門市", "阿南市", "吉野川市", "美馬市", "三好市", "小松島市", "板野町", "石井町", "那賀町"],
    "香川県": ["高松市", "丸亀市", "坂出市", "観音寺市", "三豊市", "善通寺市", "東かがわ市", "さぬき市", "直島町", "土庄町"],
    "愛媛県": ["松山市", "今治市", "新居浜市", "西条市", "宇和島市", "大洲市", "八幡浜市", "西予市", "伊予市", "東温市"],
    "高知県": ["高知市", "四万十市", "安芸市", "須崎市", "南国市", "土佐市", "香南市", "宿毛市", "室戸市", "吾川町"],
    "福岡県": ["福岡市", "北九州市", "久留米市", "飯塚市", "行橋市", "筑紫野市", "春日市", "宗像市", "柳川市", "大牟田市", "大野城市", "太宰府市", "古賀市", "直方市", "福津市", "糸島市", "嘉麻市", "宮若市", "小郡市", "豊前市"],
    "佐賀県": ["佐賀市", "唐津市", "鳥栖市", "伊万里市", "武雄市", "鹿島市", "多久市", "小城市", "嬉野市", "白石町"],
    "長崎県": ["長崎市", "佐世保市", "諫早市", "島原市", "大村市", "平戸市", "雲仙市", "松浦市", "西海市", "南島原市"],
    "熊本県": ["熊本市", "八代市", "天草市", "玉名市", "宇城市", "阿蘇市", "山鹿市", "菊池市", "宇土市", "合志市"],
    "大分県": ["大分市", "別府市", "中津市", "日田市", "佐伯市", "宇佐市", "豊後大野市", "杵築市", "由布市", "津久見市"],
    "宮崎県": ["宮崎市", "都城市", "日南市", "延岡市", "小林市", "串間市", "えびの市", "高鍋町", "西都市", "日向市"],
    "鹿児島県": ["鹿児島市", "鹿屋市", "霧島市", "薩摩川内市", "指宿市", "枕崎市", "南さつま市", "阿久根市", "出水市", "奄美市"],
    "沖縄県": ["那覇市", "浦添市", "名護市", "糸満市", "宮古島市", "石垣市", "うるま市", "宜野湾市", "本部町", "南城市"],
    "茨城県": ["水戸市", "つくば市", "土浦市", "ひたちなか市", "日立市", "取手市", "牛久市", "龍ケ崎市", "石岡市", "常総市", "鹿嶋市", "かすみがうら市", "守谷市", "神栖市", "筑西市"],
    "栃木県": ["宇都宮市", "小山市", "佐野市", "足利市", "日光市", "真岡市", "矢板市", "那須塩原市", "大田原市", "さくら市", "栃木市", "鹿沼市", "下野市", "壬生町", "高根沢町"],
    "群馬県": ["前橋市", "高崎市", "桐生市", "伊勢崎市", "館林市", "渋川市", "富岡市", "安中市", "藤岡市", "みどり市", "太田市", "沼田市", "吾妻町", "榛名町", "草津町"],
    "富山県": ["富山市", "高岡市", "氷見市", "魚津市", "黒部市", "砺波市", "小矢部市", "射水市", "南砺市", "滑川市"],
    "石川県": ["金沢市", "小松市", "七尾市", "白山市", "加賀市", "野々市市", "かほく市", "能美市", "羽咋市", "輪島市"],
    "福井県": ["福井市", "敦賀市", "鯖江市", "大野市", "勝山市", "あわら市", "越前市", "美浜町", "小浜市", "高浜町"]
}
prefecture_malls = {
    
"北海道": ["札幌ステラプレイス", "大丸札幌", "アリオ札幌", "イオン札幌桑園", "ラソラ札幌"],
"青森県": ["青森ラビナ", "ELM（エルム）", "イトーヨーカドー青森店", "サンロード青森", "さくら野百貨店青森"],
"岩手県": ["フェザン", "パルクアベニュー・カワトク", "イオンモール盛岡", "さくら野百貨店北上", "マリオス"],
"宮城県": ["仙台フォーラス", "アエル", "イオンモール名取", "ララガーデン長町", "エスパル仙台"],
"秋田県": ["フォンテAKITA", "秋田OPA", "イオンモール秋田", "ドン・キホーテ秋田", "さくら野百貨店秋田"],
"山形県": ["霞城セントラル", "山形グランドホテル", "イオンモール天童", "ヤマザワ", "S-PAL山形"],
"福島県": ["中合福島店", "イオンモールいわき", "イトーヨーカドー郡山", "うすい百貨店", "エスパル福島"],
"茨城県": ["イーアスつくば", "水戸京成百貨店", "イオンモールつくば", "LALAガーデンつくば", "メガドン・キホーテ勝田"],
"栃木県": ["東武宇都宮百貨店", "FKDショッピングプラザ", "ベルモール", "イオンモール小山", "ララスクエア宇都宮"],
"群馬県": ["高崎OPA", "イオンモール高崎", "けやきウォーク前橋", "スズラン百貨店", "ガーデン前橋"],
"埼玉県": ["イオンレイクタウン", "コクーンシティ", "そごう大宮店", "ららぽーと新三郷", "ステラタウン", "エミテラス"],
"千葉県": ["イクスピアリ", "ららぽーとTOKYO-BAY", "そごう千葉店", "イオンモール幕張新都心", "ユニモちはら台"],
"東京都": ["新宿伊勢丹", "銀座三越", "渋谷ヒカリエ", "東京ミッドタウン", "六本木ヒルズ", "丸ビル", "ルミネ新宿", "池袋サンシャインシティ", "アクアシティお台場", "ダイバーシティ東京"],
"神奈川県": ["横浜ランドマークプラザ", "みなとみらい東急スクエア", "ラゾーナ川崎", "MARK IS みなとみらい", "クイーンズスクエア横浜", "ルミネ横浜", "湘南テラスモール", "ノースポート・モール", "コレットマーレ", "アトレ川崎"],
"新潟県": ["新潟伊勢丹", "CoCoLo新潟", "ラブラ万代", "万代シティ", "イオンモール新潟南"],
"富山県": ["マリエとやま", "ファボーレ", "イオンモール高岡", "グランドプラザ", "富山大和"],
"石川県": ["香林坊アトリオ", "金沢フォーラス", "片町きらら", "イオンモール新小松", "めいてつ・エムザ"],
"福井県": ["西武福井店", "プリズム福井", "アピタ福井大和田", "ラブリーパートナーエルパ", "パリオCITY"],
"山梨県": ["甲府岡島", "イオンモール甲府昭和", "ラザウォーク甲斐双葉", "フォレストモール甲斐", "セレオ甲府"],
"長野県": ["MIDORI長野", "イオンモール松本", "ながの東急百貨店", "アリオ上田", "松本パルコ"],
"岐阜県": ["モレラ岐阜", "イオンモール各務原", "アクアウォーク大垣", "マーサ21", "カラフルタウン岐阜"],
"静岡県": ["マークイズ静岡", "ららぽーと磐田", "新静岡セノバ", "イオンモール浜松志都呂", "エスパルスドリームプラザ", "セノバ"],
"愛知県": ["名古屋栄三越", "松坂屋名古屋店", "イオンモール名古屋茶屋", "mozoワンダーシティ", "ららぽーと名古屋みなとアクルス", "オアシス21", "名鉄百貨店", "テルミナ", "ミッドランドスクエア", "サンロード名駅"],
"三重県": ["イオンモール鈴鹿", "近鉄百貨店四日市", "ジャズドリーム長島", "イオンモール東員", "四日市アピタ"],
"滋賀県": ["大津パルコ", "アル・プラザ草津", "ピエリ守山", "フォレオ大津一里山", "ビバシティ彦根"],
"京都府": ["京都ポルタ", "京都タカシマヤ", "イオンモール京都桂川", "京都ヨドバシ", "北大路ビブレ"],
"大阪府": ["梅田大丸", "なんばパークス", "グランフロント大阪", "あべのハルカス近鉄本店", "LUCUA大阪", "HEP FIVE", "天王寺ミオ", "くずはモール", "千里中央パル", "ららぽーと和泉"],
"兵庫県": ["神戸ハーバーランドumie", "阪急西宮ガーデンズ", "ピオレ姫路", "三宮オーパ", "アクタ西宮"],
"奈良県": ["イオンモール橿原", "ならファミリー", "ミ・ナーラ", "イオンモール大和郡山", "西大寺オーパ"],
"和歌山県": ["イオンモール和歌山", "和歌山MIO", "ガーデンパーク和歌山", "フォルテワジマ", "近鉄百貨店和歌山"],
"鳥取県": ["シャミネ鳥取", "イオンモール鳥取北", "イオンモール日吉津", "パープルタウン", "米子しんまち天満屋"],
"島根県": ["シャミネ松江", "イオン松江", "出雲グリーンモール", "イオンモール出雲", "一畑百貨店"],
"岡山県": ["イオンモール岡山", "岡山天満屋", "アリオ倉敷", "さんすて岡山", "イオンモール倉敷"],
"広島県": ["そごう広島店", "広島三越", "パルコ広島", "ゆめタウン広島", "LECT"],
"山口県": ["おのだサンパーク", "イオンタウン防府", "ゆめタウン山口", "シーモール下関", "アトラス萩"],
"徳島県": ["ゆめタウン徳島", "イオンモール徳島", "フジグラン北島", "徳島アミコ", "クレメントプラザ"],
"香川県": ["ゆめタウン高松", "イオンモール高松", "高松三越", "フジグラン丸亀", "丸亀町グリーン"],
"愛媛県": ["エミフルMASAKI", "いよてつ高島屋", "フジグラン松山", "アイテムえひめ", "イオンモール今治新都市"],
"高知県": ["イオンモール高知", "サンシャインヴィアン", "帯屋町アーケード", "高知大丸", "フジグラン高知"],
"福岡県": ["博多阪急", "天神地下街", "キャナルシティ博多", "ソラリアプラザ", "マリノアシティ福岡"],
"佐賀県": ["モラージュ佐賀", "ゆめタウン佐賀", "イオンモール佐賀大和", "トライアル佐賀店", "フレスポ鳥栖"],
"長崎県": ["アミュプラザ長崎", "夢彩都", "イオン大塔ショッピングセンター", "長崎浜屋", "ココウォーク長崎"],
"熊本県": ["鶴屋百貨店", "サクラマチクマモト", "イオンモール熊本", "ゆめタウン光の森", "熊本パルコ"],
"大分県": ["アミュプラザおおいた", "パークプレイス大分", "トキハ本店", "ゆめタウン中津", "大分フォーラス"],
"宮崎県": ["イオンモール宮崎", "宮崎山形屋", "ボンベルタ橘", "ニシムタN's CITY", "エミテラス"],
"鹿児島県": ["アミュプラザ鹿児島", "イオンモール鹿児島", "山形屋鹿児島", "フレスポジャングルパーク", "ドルフィンポート"],
"沖縄県": ["沖縄アウトレットモールあしびなー", "イオンモール沖縄ライカム", "サンエー浦添西海岸PARCO CITY", "那覇メインプレイス", "デパートリウボウ"]

}
prefecture_shotengai = {

    "北海道": ["すすきの", "狸小路", "北24条", "函館本町", "小樽花園"],
    "青森県": ["本町", "古川", "八戸六日町", "弘前駅前", "五所川原エルム"],
    "岩手県": ["大通り", "菜園", "肴町", "盛岡駅前", "一関本町"],
    "宮城県": ["国分町", "一番町", "仙台駅東口", "長町モール", "塩竈本町"],
    "秋田県": ["川反", "大町", "山王", "秋田駅前", "大館銀座"],
    "山形県": ["七日町", "香澄町", "山形駅前", "天童温泉街", "米沢駅前"],
    "福島県": ["大町", "郡山駅前", "福島駅前", "いわき駅前", "会津若松神明通り"],
    "茨城県": ["水戸南町", "勝田駅前", "つくば駅前", "日立銀座", "古河駅前"],
    "栃木県": ["オリオン通り", "宇都宮駅前", "佐野駅前", "小山中央通り", "足利銀座"],
    "群馬県": ["前橋中央銀座", "高崎駅西口", "桐生新町", "伊勢崎駅前", "太田駅前"],
    "埼玉県": ["大宮南銀座", "浦和駅東口", "川越クレアモール", "越谷レイクタウン", "所沢プロぺ通り"],
    "千葉県": ["千葉中央", "船橋駅前", "柏駅西口", "成田駅前", "木更津富士見"],
    "東京都": ["新宿歌舞伎町", "六本木", "渋谷センター街", "銀座コリドー街", "池袋西口"],
    "神奈川県": ["横浜野毛", "関内伊勢佐木町", "川崎駅東口", "藤沢南口", "小田原駅前"],
    "新潟県": ["古町", "万代シティ", "新潟駅前", "長岡駅前", "上越高田本町"],
    "富山県": ["総曲輪", "富山駅前", "高岡駅前", "魚津駅前", "黒部メルヘン"],
    "石川県": ["片町", "香林坊", "金沢駅前", "野々市駅前", "七尾一本杉"],
    "福井県": ["片町", "福井駅前", "鯖江本町", "敦賀駅前", "小浜駅前"],
    "山梨県": ["甲府中央", "石和温泉街", "富士吉田本町", "韮崎駅前", "大月駅前"],
    "長野県": ["長野駅前", "権堂", "松本駅前", "上田駅前", "佐久平駅前"],
    "岐阜県": ["柳ヶ瀬", "岐阜駅前", "多治見駅前", "大垣駅前", "飛騨高山駅前"],
    "静岡県": ["両替町", "静岡駅南口", "浜松有楽街", "富士駅前", "伊東温泉街"],
    "愛知県": ["栄", "錦三丁目", "名駅西口", "豊橋広小路", "岡崎康生"],
    "三重県": ["四日市駅前", "津駅前", "松阪駅前", "伊勢おかげ横丁", "桑名駅前"],
    "滋賀県": ["浜大津", "草津駅前", "彦根駅前", "近江八幡駅前", "守山駅前"],
    "京都府": ["木屋町", "祇園", "河原町", "伏見桃山", "京都駅前"],
    "大阪府": ["ミナミ（難波・心斎橋）", "北新地", "京橋", "天王寺", "十三"],
    "兵庫県": ["三宮", "元町", "姫路駅前", "尼崎中央", "西宮北口"],
    "奈良県": ["奈良駅前", "近鉄奈良", "大和西大寺", "天理駅前", "王寺駅前"],
    "和歌山県": ["ぶらくり丁", "和歌山駅前", "田辺駅前", "新宮駅前", "海南駅前"],
    "鳥取県": ["鳥取駅前", "米子駅前", "倉吉銀座", "境港駅前", "浜村温泉街"],
    "島根県": ["松江駅前", "出雲駅前", "浜田銀座", "益田駅前", "石見銀山"],
    "岡山県": ["岡山駅前", "倉敷美観地区", "津山駅前", "総社駅前", "玉野駅前"],
    "広島県": ["流川", "横川駅前", "紙屋町", "呉れんが通り", "尾道駅前"],
    "山口県": ["新下関", "徳山銀座", "宇部中央", "防府駅前", "岩国駅前"],
    "徳島県": ["徳島駅前", "阿南駅前", "鳴門駅前", "小松島駅前", "石井町"],
    "香川県": ["高松瓦町", "丸亀駅前", "観音寺駅前", "坂出駅前", "琴平温泉街"],
    "愛媛県": ["大街道", "松山駅前", "今治駅前", "新居浜駅前", "宇和島駅前"],
    "高知県": ["帯屋町", "高知駅前", "南国駅前", "須崎駅前", "中村駅前"],
    "福岡県": ["中洲", "天神", "博多駅前", "小倉駅前", "久留米駅前"],
    "佐賀県": ["佐賀駅前", "鳥栖駅前", "唐津駅前", "伊万里駅前", "武雄温泉街"],
    "長崎県": ["浜町", "長崎駅前", "佐世保四ヶ町", "島原温泉街", "諫早駅前"],
    "熊本県": ["下通", "新市街", "上通", "熊本駅前", "八代駅前"],
    "大分県": ["都町", "別府駅前", "大分駅前", "佐伯駅前", "日田駅前"],
    "宮崎県": ["橘通り", "宮崎駅前", "都城駅前", "延岡駅前", "日南駅前"],
    "鹿児島県": ["天文館", "中央駅前", "奄美大島屋仁川", "指宿温泉街", "出水駅前"],
    "沖縄県": ["国際通り", "松山", "美栄橋", "コザゲート通り", "石垣島730通り"]
}

# サンプル都道府県リスト
prefectures = list(prefecture_stations.keys())

class RequestData(BaseModel):
    text: str
    prefecture: str

def get_random_location(prefecture, location_list):
    if prefecture in location_list:
        return random.choice(location_list[prefecture])
    return ""

def detect_entity(text):
    tokens = sudachi_tokenizer.tokenize(text, mode="C")  # "C" モードで長い単語を優先
    entities = [m.surface() for m in tokens if m.part_of_speech()[0] == "名詞"]
    return entities

import re

def convert_text(text, source_prefecture, target_prefecture):
    words = detect_entity(text)
    
    for word in words:
        # 駅名変換
        if any(re.search(re.escape(w), word) for w in prefecture_stations[source_prefecture]):
            text = text.replace(word, get_random_location(target_prefecture, prefecture_stations))
        
        # 市町村変換
        elif any(re.search(re.escape(w), word) for w in prefecture_cities[source_prefecture]):
            text = text.replace(word, get_random_location(target_prefecture, prefecture_cities))
        
        # 商業施設変換（部分一致で検索）
        elif any(re.search(re.escape(w), text) for w in prefecture_malls[source_prefecture]):
            match = next((w for w in prefecture_malls[source_prefecture] if re.search(re.escape(w), text)), None)
            if match:
                text = text.replace(match, get_random_location(target_prefecture, prefecture_malls))
        
        # 商店街変換（部分一致で検索）
        elif any(re.search(re.escape(w), text) for w in prefecture_shotengai[source_prefecture]):
            match = next((w for w in prefecture_shotengai[source_prefecture] if re.search(re.escape(w), text)), None)
            if match:
                text = text.replace(match, get_random_location(target_prefecture, prefecture_shotengai))
    
    return text


@app.post("/convert_location")
def convert_location(data: RequestData):
    if data.prefecture not in prefectures:
        return {"error": "Invalid prefecture"}
    
    target_prefecture = random.choice([p for p in prefectures if p != data.prefecture])
    converted_text = convert_text(data.text, data.prefecture, target_prefecture)
    
    return {"converted_text": converted_text, "new_prefecture": target_prefecture}
